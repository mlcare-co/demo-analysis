<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Combined Financial Impact Analysis</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.26.0/plotly.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            max-width: 1200px;
            width: 100%;
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #9b59b6;
            padding-bottom: 15px;
            margin-bottom: 30px;
            font-size: 2.2rem;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .metric-card {
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .los-card {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }
        
        .hac-card {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        
        .readmit-card {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }
        
        .total-card {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            grid-column: span 2;
        }
        
        .metric-card h3 {
            color: white;
            font-size: 0.9rem;
            font-weight: normal;
            opacity: 0.9;
            margin-bottom: 5px;
        }
        
        .metric-card .value {
            color: white;
            font-size: 2rem;
            font-weight: bold;
            margin: 5px 0;
        }
        
        .metric-card .detail {
            color: white;
            font-size: 0.85rem;
            opacity: 0.8;
        }
        
        .chart-container {
            margin: 40px 0;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 12px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.06);
        }
        
        .chart-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .insight-box {
            background: linear-gradient(135deg, #f5f3ff, #ebe7ff);
            border-left: 4px solid #9b59b6;
            padding: 20px;
            margin: 30px 0;
            border-radius: 8px;
        }
        
        .insight-box h3 {
            color: #8e44ad;
            margin-bottom: 10px;
        }
        
        .breakdown-table {
            width: 100%;
            margin: 30px 0;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .breakdown-table th {
            background: #8e44ad;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        
        .breakdown-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #ecf0f1;
        }
        
        .breakdown-table tr:hover {
            background: #f8f9fa;
        }
        
        .los-row { border-left: 4px solid #3498db; }
        .hac-row { border-left: 4px solid #e74c3c; }
        .readmit-row { border-left: 4px solid #f39c12; }
        .total-row { 
            background: #f5f3ff !important; 
            font-weight: bold;
            border-left: 4px solid #9b59b6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Combined Financial Impact Analysis - Quality Improvement Opportunities</h1>
        
        <div class="summary-grid">
            <div class="metric-card los-card">
                <h3>Length of Stay</h3>
                <div class="value">€3.9M</div>
                <div class="detail">12,000 excess days</div>
            </div>
            <div class="metric-card hac-card">
                <h3>HACs</h3>
                <div class="value">€2.1M</div>
                <div class="detail">720 complications</div>
            </div>
            <div class="metric-card readmit-card">
                <h3>Readmissions</h3>
                <div class="value">€4.8M</div>
                <div class="detail">809 avoidable</div>
            </div>
            <div class="metric-card total-card">
                <h3>Total Annual Opportunity</h3>
                <div class="value">€10.8M</div>
                <div class="detail">Combined financial impact</div>
            </div>
        </div>

        <div class="chart-container">
            <div class="chart-title">Cumulative Financial Impact Build-Up</div>
            <div id="combined-waterfall"></div>
        </div>

        <table class="breakdown-table">
            <thead>
                <tr>
                    <th>Category</th>
                    <th>Volume</th>
                    <th>Unit Impact</th>
                    <th>Total Impact</th>
                    <th>% of Total</th>
                </tr>
            </thead>
            <tbody>
                <tr class="los-row">
                    <td>Excess LOS - Medical</td>
                    <td>5,680 days</td>
                    <td>€325/day</td>
                    <td>€1,846,000</td>
                    <td>17.1%</td>
                </tr>
                <tr class="los-row">
                    <td>Excess LOS - Surgical</td>
                    <td>6,320 days</td>
                    <td>€325/day</td>
                    <td>€2,054,000</td>
                    <td>19.0%</td>
                </tr>
                <tr class="hac-row">
                    <td>Surgical Site Infections</td>
                    <td>223 cases</td>
                    <td>€2,900/case</td>
                    <td>€646,700</td>
                    <td>6.0%</td>
                </tr>
                <tr class="hac-row">
                    <td>Other HACs</td>
                    <td>497 cases</td>
                    <td>€2,933/case</td>
                    <td>€1,458,300</td>
                    <td>13.5%</td>
                </tr>
                <tr class="readmit-row">
                    <td>Avoidable Readmissions - Chronic</td>
                    <td>485 cases</td>
                    <td>€5,900/case</td>
                    <td>€2,861,500</td>
                    <td>26.5%</td>
                </tr>
                <tr class="readmit-row">
                    <td>Avoidable Readmissions - Acute</td>
                    <td>324 cases</td>
                    <td>€5,900/case</td>
                    <td>€1,911,600</td>
                    <td>17.7%</td>
                </tr>
                <tr class="total-row">
                    <td>TOTAL</td>
                    <td>-</td>
                    <td>-</td>
                    <td>€10,778,100</td>
                    <td>100%</td>
                </tr>
            </tbody>
        </table>

        <div class="insight-box">
            <h3>Interconnected Impact Analysis</h3>
            <p><strong>Overlap Considerations:</strong></p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>HAC patients contribute 15% of excess LOS days (already included in LOS figures)</li>
                <li>HAC patients have 24.2% readmission rate vs 13.5% for non-HAC patients</li>
                <li>Extended LOS patients (>7 days) show 18.6% readmission rate vs 11.3% baseline</li>
                <li>Estimated overlap adjustment: -€980,000 to avoid double-counting</li>
            </ul>
            <p style="margin-top: 15px;"><strong>Net Opportunity: €9.8M</strong> after removing overlapping impacts</p>
        </div>

        <div class="insight-box">
            <h3>Priority Targeting</h3>
            <p>Based on the analysis, focusing on these high-impact areas:</p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li><strong>Cardiology + Internal Medicine:</strong> €4.8M combined (44% of total)</li>
                <li><strong>Orthopedics + Surgery:</strong> €3.9M combined (36% of total)</li>
                <li><strong>Preventable factors:</strong> Discharge planning, infection prevention, care coordination</li>
            </ul>
        </div>
    </div>

    <script>
        window.addEventListener('load', function() {
            // Combined Financial Waterfall
            const waterfallData = {
                x: ['Baseline<br>Operations', 'Excess LOS<br>Medical', 'Excess LOS<br>Surgical', 
                    'Surgical Site<br>Infections', 'Other<br>HACs', 'Chronic Disease<br>Readmissions', 
                    'Acute Care<br>Readmissions', 'Gross<br>Impact', 'Overlap<br>Adjustment', 'Net Quality<br>Opportunity'],
                y: [0, 1846000, 2054000, 646700, 1458300, 2861500, 1911600, 0, -980000, 0],
                measure: ['absolute', 'relative', 'relative', 'relative', 'relative', 'relative', 
                         'relative', 'total', 'relative', 'total'],
                text: ['€0', '+€1.85M', '+€2.05M', '+€0.65M', '+€1.46M', '+€2.86M', 
                      '+€1.91M', '€10.78M', '-€0.98M', '€9.80M'],
                textposition: 'outside',
                connector: {line: {color: 'rgb(63, 63, 63)'}},
                increasing: {marker: {color: 'rgba(155, 89, 182, 0.8)'}},
                decreasing: {marker: {color: 'rgba(46, 204, 113, 0.8)'}},
                totals: {marker: {color: 'rgba(142, 68, 173, 1.0)'}}
            };

            // Add custom colors for each category
            const customColors = [
                'rgba(200, 200, 200, 0.8)', // Baseline
                'rgba(52, 152, 219, 0.8)',  // LOS Medical (blue)
                'rgba(52, 152, 219, 0.8)',  // LOS Surgical (blue)
                'rgba(231, 76, 60, 0.8)',   // SSI (red)
                'rgba(231, 76, 60, 0.8)',   // Other HACs (red)
                'rgba(243, 156, 18, 0.8)',  // Chronic Readmit (orange)
                'rgba(243, 156, 18, 0.8)',  // Acute Readmit (orange)
                'rgba(142, 68, 173, 1.0)',  // Gross total (purple)
                'rgba(46, 204, 113, 0.8)',  // Adjustment (green)
                'rgba(142, 68, 173, 1.0)'   // Net total (purple)
            ];

            const waterfallTrace = {
                type: 'waterfall',
                orientation: 'v',
                x: waterfallData.x,
                y: waterfallData.y,
                text: waterfallData.text,
                textposition: waterfallData.textposition,
                measure: waterfallData.measure,
                connector: waterfallData.connector,
                marker: {
                    color: customColors
                }
            };

            const layout = {
                yaxis: {
                    title: 'Financial Impact (€)',
                    tickformat: ',.0f',
                    gridcolor: '#e0e0e0'
                },
                xaxis: {
                    type: 'category',
                    tickangle: -45
                },
                height: 500,
                showlegend: false,
                margin: {l: 80, r: 40, t: 40, b: 120},
                plot_bgcolor: '#fafafa',
                paper_bgcolor: '#f8f9fa',
                autosize: true,
                annotations: [
                    {
                        x: 1.5,
                        y: 3900000,
                        text: 'LOS Impact<br>€3.9M',
                        showarrow: false,
                        font: {size: 12, color: '#2980b9'},
                        bgcolor: 'rgba(52, 152, 219, 0.1)',
                        bordercolor: '#3498db',
                        borderwidth: 1,
                        borderpad: 4
                    },
                    {
                        x: 3.5,
                        y: 5000000,
                        text: 'HAC Impact<br>€2.1M',
                        showarrow: false,
                        font: {size: 12, color: '#c0392b'},
                        bgcolor: 'rgba(231, 76, 60, 0.1)',
                        bordercolor: '#e74c3c',
                        borderwidth: 1,
                        borderpad: 4
                    },
                    {
                        x: 5.5,
                        y: 8500000,
                        text: 'Readmission Impact<br>€4.8M',
                        showarrow: false,
                        font: {size: 12, color: '#d68910'},
                        bgcolor: 'rgba(243, 156, 18, 0.1)',
                        bordercolor: '#f39c12',
                        borderwidth: 1,
                        borderpad: 4
                    }
                ]
            };

            Plotly.newPlot('combined-waterfall', [waterfallTrace], layout);
        });
    </script>
</body>
</html>